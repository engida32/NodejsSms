"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _Utils = _interopRequireDefault(require("./Utils"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var querystring = require("querystring");
/**
 * Provides access to the `ShortCode` endpoint.
 */


class ShortCode {
  static get PATH() {
    return "/sc/us/${type}/json";
  }

  static get ERROR_MESSAGES() {
    return {
      to: "Invalid to address",
      msgParams: "Invalid shortcode message parameters"
    };
  }
  /**
   * @param {Credentials} credentials
   *    credentials to be used when interacting with the API.
   * @param {Object} options
   *    Additional ShortCode options.
   */


  constructor(credentials) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    this.creds = credentials;
    this.options = options;
  }

  _sendRequest(endpoint, method, callback) {
    endpoint.path = endpoint.path + (endpoint.path.indexOf("?") > 0 ? "&" : "?") + querystring.stringify({
      api_key: this.creds.apiKey,
      api_secret: this.creds.apiSecret
    });
    this.options.httpClient.request(endpoint, method, callback);
  }

  _sendViaShortcode(type, recipient, messageParams, opts, callback) {
    if (!recipient) {
      _Utils.default.sendError(callback, new Error(ShortCode.ERROR_MESSAGES.to));
    }

    if (!messageParams || !Object.keys(messageParams)) {
      _Utils.default.sendError(callback, new Error(ShortCode.ERROR_MESSAGES.msgParams));
    }

    opts = opts || {};
    var path = ShortCode.PATH.replace("${type}", type);
    Object.keys(messageParams).forEach(function (key) {
      opts[key] = messageParams[key];
    });
    opts.to = recipient;
    path += "?" + querystring.stringify(opts);
    this.options.logger.info("sending message from shortcode " + type + " to " + recipient + " with parameters " + JSON.stringify(messageParams));

    this._sendRequest({
      host: this.options.restHost || "rest.nexmo.com",
      path: path
    }, "POST", function (err, apiResponse) {
      if (!err && apiResponse.status && apiResponse.messages[0].status > 0) {
        _Utils.default.sendError(callback, new Error(apiResponse.messages[0]["error-text"]), apiResponse);
      } else {
        if (callback) callback(err, apiResponse);
      }
    });
  }

  shortcodeAlert(recipient, messageParams, opts, callback) {
    this._sendViaShortcode("alert", recipient, messageParams, opts, callback);
  }

  shortcode2FA(recipient, messageParams, opts, callback) {
    this._sendViaShortcode("2fa", recipient, messageParams, opts, callback);
  }

  shortcodeMarketing(recipient, messageParams, opts, callback) {
    this._sendViaShortcode("marketing", recipient, messageParams, opts, callback);
  }

}

var _default = ShortCode;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TaG9ydENvZGUuanMiXSwibmFtZXMiOlsicXVlcnlzdHJpbmciLCJyZXF1aXJlIiwiU2hvcnRDb2RlIiwiUEFUSCIsIkVSUk9SX01FU1NBR0VTIiwidG8iLCJtc2dQYXJhbXMiLCJjb25zdHJ1Y3RvciIsImNyZWRlbnRpYWxzIiwib3B0aW9ucyIsImNyZWRzIiwiX3NlbmRSZXF1ZXN0IiwiZW5kcG9pbnQiLCJtZXRob2QiLCJjYWxsYmFjayIsInBhdGgiLCJpbmRleE9mIiwic3RyaW5naWZ5IiwiYXBpX2tleSIsImFwaUtleSIsImFwaV9zZWNyZXQiLCJhcGlTZWNyZXQiLCJodHRwQ2xpZW50IiwicmVxdWVzdCIsIl9zZW5kVmlhU2hvcnRjb2RlIiwidHlwZSIsInJlY2lwaWVudCIsIm1lc3NhZ2VQYXJhbXMiLCJvcHRzIiwiVXRpbHMiLCJzZW5kRXJyb3IiLCJFcnJvciIsIk9iamVjdCIsImtleXMiLCJyZXBsYWNlIiwiZm9yRWFjaCIsImtleSIsImxvZ2dlciIsImluZm8iLCJKU09OIiwiaG9zdCIsInJlc3RIb3N0IiwiZXJyIiwiYXBpUmVzcG9uc2UiLCJzdGF0dXMiLCJtZXNzYWdlcyIsInNob3J0Y29kZUFsZXJ0Iiwic2hvcnRjb2RlMkZBIiwic2hvcnRjb2RlTWFya2V0aW5nIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztBQUVBOzs7O0FBRUEsSUFBSUEsV0FBVyxHQUFHQyxPQUFPLENBQUMsYUFBRCxDQUF6QjtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0EsTUFBTUMsU0FBTixDQUFnQjtBQUNkLGFBQVdDLElBQVgsR0FBa0I7QUFDaEIsV0FBTyxxQkFBUDtBQUNEOztBQUVELGFBQVdDLGNBQVgsR0FBNEI7QUFDMUIsV0FBTztBQUNMQyxNQUFBQSxFQUFFLEVBQUUsb0JBREM7QUFFTEMsTUFBQUEsU0FBUyxFQUFFO0FBRk4sS0FBUDtBQUlEO0FBRUQ7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDRUMsRUFBQUEsV0FBVyxDQUFDQyxX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LFFBQUosRUFBY0EsUUFBUSxDQUFDNEIsR0FBRCxFQUFNQyxXQUFOLENBQVI7QUFDZjtBQUNGLEtBaEJIO0FBa0JEOztBQUVERyxFQUFBQSxjQUFjLENBQUNwQixTQUFELEVBQVlDLGFBQVosRUFBMkJDLElBQTNCLEVBQWlDZCxRQUFqQyxFQUEyQztBQUN2RCxTQUFLVSxpQkFBTCxDQUF1QixPQUF2QixFQUFnQ0UsU0FBaEMsRUFBMkNDLGFBQTNDLEVBQTBEQyxJQUExRCxFQUFnRWQsUUFBaEU7QUFDRDs7QUFDRGlDLEVBQUFBLFlBQVksQ0FBQ3JCLFNBQUQsRUFBWUMsYUFBWixFQUEyQkMsSUFBM0IsRUFBaUNkLFFBQWpDLEVBQTJDO0FBQ3JELFNBQUtVLGlCQUFMLENBQXVCLEtBQXZCLEVBQThCRSxTQUE5QixFQUF5Q0MsYUFBekMsRUFBd0RDLElBQXhELEVBQThEZCxRQUE5RDtBQUNEOztBQUNEa0MsRUFBQUEsa0JBQWtCLENBQUN0QixTQUFELEVBQVlDLGFBQVosRUFBMkJDLElBQTNCLEVBQWlDZCxRQUFqQyxFQUEyQztBQUMzRCxTQUFLVSxpQkFBTCxDQUNFLFdBREYsRUFFRUUsU0FGRixFQUdFQyxhQUhGLEVBSUVDLElBSkYsRUFLRWQsUUFMRjtBQU9EOztBQTFGYTs7ZUE2RkRaLFMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IFV0aWxzIGZyb20gXCIuL1V0aWxzXCI7XG5cbnZhciBxdWVyeXN0cmluZyA9IHJlcXVpcmUoXCJxdWVyeXN0cmluZ1wiKTtcblxuLyoqXG4gKiBQcm92aWRlcyBhY2Nlc3MgdG8gdGhlIGBTaG9ydENvZGVgIGVuZHBvaW50LlxuICovXG5jbGFzcyBTaG9ydENvZGUge1xuICBzdGF0aWMgZ2V0IFBBVEgoKSB7XG4gICAgcmV0dXJuIFwiL3NjL3VzLyR7dHlwZX0vanNvblwiO1xuICB9XG5cbiAgc3RhdGljIGdldCBFUlJPUl9NRVNTQUdFUygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdG86IFwiSW52YWxpZCB0byBhZGRyZXNzXCIsXG4gICAgICBtc2dQYXJhbXM6IFwiSW52YWxpZCBzaG9ydGNvZGUgbWVzc2FnZSBwYXJhbWV0ZXJzXCJcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7Q3JlZGVudGlhbHN9IGNyZWRlbnRpYWxzXG4gICAqICAgIGNyZWRlbnRpYWxzIHRvIGJlIHVzZWQgd2hlbiBpbnRlcmFjdGluZyB3aXRoIHRoZSBBUEkuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG4gICAqICAgIEFkZGl0aW9uYWwgU2hvcnRDb2RlIG9wdGlvbnMuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihjcmVkZW50aWFscywgb3B0aW9ucyA9IHt9KSB7XG4gICAgdGhpcy5jcmVkcyA9IGNyZWRlbnRpYWxzO1xuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gIH1cblxuICBfc2VuZFJlcXVlc3QoZW5kcG9pbnQsIG1ldGhvZCwgY2FsbGJhY2spIHtcbiAgICBlbmRwb2ludC5wYXRoID1cbiAgICAgIGVuZHBvaW50LnBhdGggK1xuICAgICAgKGVuZHBvaW50LnBhdGguaW5kZXhPZihcIj9cIikgPiAwID8gXCImXCIgOiBcIj9cIikgK1xuICAgICAgcXVlcnlzdHJpbmcuc3RyaW5naWZ5KHtcbiAgICAgICAgYXBpX2tleTogdGhpcy5jcmVkcy5hcGlLZXksXG4gICAgICAgIGFwaV9zZWNyZXQ6IHRoaXMuY3JlZHMuYXBpU2VjcmV0XG4gICAgICB9KTtcbiAgICB0aGlzLm9wdGlvbnMuaHR0cENsaWVudC5yZXF1ZXN0KGVuZHBvaW50LCBtZXRob2QsIGNhbGxiYWNrKTtcbiAgfVxuXG4gIF9zZW5kVmlhU2hvcnRjb2RlKHR5cGUsIHJlY2lwaWVudCwgbWVzc2FnZVBhcmFtcywgb3B0cywgY2FsbGJhY2spIHtcbiAgICBpZiAoIXJlY2lwaWVudCkge1xuICAgICAgVXRpbHMuc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoU2hvcnRDb2RlLkVSUk9SX01FU1NBR0VTLnRvKSk7XG4gICAgfVxuICAgIGlmICghbWVzc2FnZVBhcmFtcyB8fCAhT2JqZWN0LmtleXMobWVzc2FnZVBhcmFtcykpIHtcbiAgICAgIFV0aWxzLnNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKFNob3J0Q29kZS5FUlJPUl9NRVNTQUdFUy5tc2dQYXJhbXMpKTtcbiAgICB9XG4gICAgb3B0cyA9IG9wdHMgfHwge307XG4gICAgdmFyIHBhdGggPSBTaG9ydENvZGUuUEFUSC5yZXBsYWNlKFwiJHt0eXBlfVwiLCB0eXBlKTtcbiAgICBPYmplY3Qua2V5cyhtZXNzYWdlUGFyYW1zKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgICAgb3B0c1trZXldID0gbWVzc2FnZVBhcmFtc1trZXldO1xuICAgIH0pO1xuICAgIG9wdHMudG8gPSByZWNpcGllbnQ7XG4gICAgcGF0aCArPSBcIj9cIiArIHF1ZXJ5c3RyaW5nLnN0cmluZ2lmeShvcHRzKTtcbiAgICB0aGlzLm9wdGlvbnMubG9nZ2VyLmluZm8oXG4gICAgICBcInNlbmRpbmcgbWVzc2FnZSBmcm9tIHNob3J0Y29kZSBcIiArXG4gICAgICAgIHR5cGUgK1xuICAgICAgICBcIiB0byBcIiArXG4gICAgICAgIHJlY2lwaWVudCArXG4gICAgICAgIFwiIHdpdGggcGFyYW1ldGVycyBcIiArXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KG1lc3NhZ2VQYXJhbXMpXG4gICAgKTtcbiAgICB0aGlzLl9zZW5kUmVxdWVzdChcbiAgICAgIHtcbiAgICAgICAgaG9zdDogdGhpcy5vcHRpb25zLnJlc3RIb3N0IHx8IFwicmVzdC5uZXhtby5jb21cIixcbiAgICAgICAgcGF0aDogcGF0aFxuICAgICAgfSxcbiAgICAgIFwiUE9TVFwiLFxuICAgICAgZnVuY3Rpb24oZXJyLCBhcGlSZXNwb25zZSkge1xuICAgICAgICBpZiAoIWVyciAmJiBhcGlSZXNwb25zZS5zdGF0dXMgJiYgYXBpUmVzcG9uc2UubWVzc2FnZXNbMF0uc3RhdHVzID4gMCkge1xuICAgICAgICAgIFV0aWxzLnNlbmRFcnJvcihcbiAgICAgICAgICAgIGNhbGxiYWNrLFxuICAgICAgICAgICAgbmV3IEVycm9yKGFwaVJlc3BvbnNlLm1lc3NhZ2VzWzBdW1wiZXJyb3ItdGV4dFwiXSksXG4gICAgICAgICAgICBhcGlSZXNwb25zZVxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjayhlcnIsIGFwaVJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gIH1cblxuICBzaG9ydGNvZGVBbGVydChyZWNpcGllbnQsIG1lc3NhZ2VQYXJhbXMsIG9wdHMsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5fc2VuZFZpYVNob3J0Y29kZShcImFsZXJ0XCIsIHJlY2lwaWVudCwgbWVzc2FnZVBhcmFtcywgb3B0cywgY2FsbGJhY2spO1xuICB9XG4gIHNob3J0Y29kZTJGQShyZWNpcGllbnQsIG1lc3NhZ2VQYXJhbXMsIG9wdHMsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5fc2VuZFZpYVNob3J0Y29kZShcIjJmYVwiLCByZWNpcGllbnQsIG1lc3NhZ2VQYXJhbXMsIG9wdHMsIGNhbGxiYWNrKTtcbiAgfVxuICBzaG9ydGNvZGVNYXJrZXRpbmcocmVjaXBpZW50LCBtZXNzYWdlUGFyYW1zLCBvcHRzLCBjYWxsYmFjaykge1xuICAgIHRoaXMuX3NlbmRWaWFTaG9ydGNvZGUoXG4gICAgICBcIm1hcmtldGluZ1wiLFxuICAgICAgcmVjaXBpZW50LFxuICAgICAgbWVzc2FnZVBhcmFtcyxcbiAgICAgIG9wdHMsXG4gICAgICBjYWxsYmFja1xuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgU2hvcnRDb2RlO1xuIl19